<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Gandhi Ji - AI Mentor of Peace</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" />
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Roboto&display=swap" rel="stylesheet" />
  <style>
    * { box-sizing: border-box; transition: background-color 0.3s, color 0.3s; }
    body {
      margin: 0;
      font-family: 'Roboto', sans-serif;
      background-color: #f5f9f4;
      color: #000;
    }
    .dark-mode { background-color: #121212; color: #ddd; }
    .header {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      z-index: 1001;
      background-color: #4a7c59;
      color: #fff;
      padding: 10px 16px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-family: 'Orbitron', sans-serif;
      font-size: 20px;
    }
    .header button {
      background: none;
      border: 1px solid #fff;
      color: #fff;
      padding: 4px 10px;
      border-radius: 8px;
      cursor: pointer;
    }
    .container {
      display: flex;
      flex-direction: column;
      height: 100dvh;
      padding-top: 52px;
    }
    .chatbox {
      flex: 1;
      padding: 10px;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
      gap: 10px;
      background-color: #f5f9f4;
    }
    .dark-mode .chatbox { background-color: #1e1e1e; }
    .chat-message {
      padding: 10px 14px;
      border-radius: 12px;
      max-width: 80%;
      word-wrap: break-word;
      white-space: pre-wrap;
    }
    .user-message {
      align-self: flex-end;
      background-color: #4a7c59;
      color: #fff;
      border-top-left-radius: 0;
    }
    .dark-mode .user-message { background-color: #5ba377; }
    .assistant-message {
      align-self: flex-start;
      background-color: #fff;
      border: 1px solid #c4d9f1;
      color: #000;
      display: flex;
      align-items: flex-start;
      gap: 10px;
      border-top-right-radius: 0;
    }
    .dark-mode .assistant-message { background-color: #2a2a2a; border-color: #555; color: #ddd; }
    .assistant-avatar {
      width: 32px;
      height: 32px;
      background-color: #4a7c59;
      border-radius: 50%;
      display: flex;
      justify-content: center;
      align-items: center;
      color: #fff;
      font-weight: bold;
      font-size: 16px;
      flex-shrink: 0;
    }
    .typing-indicator {
      font-style: italic;
      opacity: 0.7;
      color: #555;
      font-size: 14px;
      padding-left: 12px;
    }
    .dark-mode .typing-indicator { color: #aaa; }
    .input-area {
      padding: 6px 10px;
      display: flex;
      align-items: center;
      gap: 6px;
      background-color: #f0f5ef;
      border-top: 1px solid #cfd8cf;
    }
    .dark-mode .input-area { background-color: #1e1e1e; border-top-color: #444; }
    .input-area input {
      flex: 1;
      padding: 10px;
      background-color: #fff;
      border: 1px solid #4a7c59;
      color: black;
      border-radius: 20px;
    }
    .dark-mode .input-area input { background-color: #2a2a2a; border-color: #5ba377; color: #ddd; }
    .input-area button {
      padding: 10px;
      border: none;
      border-radius: 20px;
      background-color: #4a7c59;
      color: #fff;
      font-weight: bold;
      cursor: pointer;
    }
    .dark-mode .input-area button { background-color: #5ba377; }
  </style>
</head>
<body>
  <div class="header">
    Gandhi Ji - AI Mentor of Peace
    <button id="toggleTheme">🌙 Dark Mode</button>
  </div>
  <div class="container">
    <div class="chatbox" id="chatbox"></div>
    <div class="typing-indicator" id="typingIndicator" style="display:none;">Gandhi Ji is reflecting...</div>
    <div class="input-area">
      <input id="chatInput" type="text" placeholder="Ask Gandhi Ji for guidance...">
      <button id="sendButton">➤</button>
    </div>
    <div style="text-align: center; padding: 8px; font-size: 14px; color: #555;">
      Guided by Truth & Peace | Crafted by <strong>Shaikh Arkan</strong>
    </div>
  </div>

  <script>
    const body = document.body;
    const toggleThemeBtn = document.getElementById('toggleTheme');
    toggleThemeBtn.addEventListener('click', () => {
      body.classList.toggle('dark-mode');
      toggleThemeBtn.textContent = body.classList.contains('dark-mode') ? '☀️ Light Mode' : '🌙 Dark Mode';
    });

    const chatbox = document.getElementById('chatbox');
    const chatInput = document.getElementById('chatInput');
    const sendButton = document.getElementById('sendButton');
    const typingIndicator = document.getElementById('typingIndicator');
    let chatHistory = [];

    const gandhiPrompt = `
You are "Gandhi Ji", an AI representation of Mahatma Gandhi's mindset and philosophy.
You speak with humility, calmness, and wisdom.
You believe in peace, simplicity, patience, self-discipline, and truth.
Your replies should reflect compassion, humanity, and moral clarity.
Never say “I am Gandhi Ji”, but always speak in his reflective and spiritual style.
Always respond in the same language or tone as the user (English, Hindi, Hinglish, etc.).
Encourage self-thought, truth, kindness, and purpose.
`;

    async function displayMessage(message, isUser) {
      const msgElem = document.createElement('div');
      msgElem.className = `chat-message ${isUser ? 'user-message' : 'assistant-message'}`;
      if (!isUser) {
        const avatar = document.createElement('div');
        avatar.className = 'assistant-avatar';
        avatar.textContent = '🕊️';
        msgElem.appendChild(avatar);
      }
      const text = document.createElement('div');
      if (isUser) {
        text.textContent = message;
        msgElem.appendChild(text);
        chatbox.appendChild(msgElem);
        chatbox.scrollTop = chatbox.scrollHeight;
      } else {
        msgElem.appendChild(text);
        chatbox.appendChild(msgElem);
        chatbox.scrollTop = chatbox.scrollHeight;
        await typeText(text, message);
      }
    }

    function typeText(element, text) {
      return new Promise((resolve) => {
        let i = 0;
        element.textContent = '';
        const speed = 15;
        function type() {
          if (i < text.length) {
            element.textContent += text.charAt(i);
            i++;
            chatbox.scrollTop = chatbox.scrollHeight;
            setTimeout(type, speed);
          } else resolve();
        }
        type();
      });
    }

    async function callApi(prompt) {
      typingIndicator.style.display = 'block';
      const recentHistory = chatHistory.slice(-10);

      const systemPrompt = `${gandhiPrompt}

Conversation so far:
${recentHistory.map(entry => entry.role === 'user' ? 'User: ' + entry.text : 'Gandhi Ji: ' + entry.text).join('\n')}

User: ${prompt}
Gandhi Ji (respond with empathy, calmness, and truth):`;

      try {
        const response = await fetch('https://backend.buildpicoapps.com/aero/run/llm-api?pk=v1-Z0FBQUFBQm5HUEtMSjJkakVjcF9IQ0M0VFhRQ0FmSnNDSHNYTlJSblE0UXo1Q3RBcjFPcl9YYy1OZUhteDZWekxHdWRLM1M1alNZTkJMWEhNOWd4S1NPSDBTWC12M0U2UGc9PQ==', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ prompt: systemPrompt })
        });

        const data = await response.json();
        typingIndicator.style.display = 'none';
        if (data.status === 'success') {
          await displayMessage(data.text, false);
          chatHistory.push({ role: 'assistant', text: data.text });
        } else {
          await displayMessage('Something went wrong, my friend.', false);
        }
      } catch (error) {
        typingIndicator.style.display = 'none';
        await displayMessage('Connection error: ' + error.message, false);
      }
    }

    sendButton.addEventListener('click', async () => {
      const message = chatInput.value.trim();
      if (!message) return;
      displayMessage(message, true);
      chatHistory.push({ role: 'user', text: message });
      chatInput.value = '';
      await callApi(message);
    });

    chatInput.addEventListener('keydown', (e) => {
      if (e.key === 'Enter' && !e.shiftKey) {
        e.preventDefault();
        sendButton.click();
      }
    });
  </script>
</body>
</html>
